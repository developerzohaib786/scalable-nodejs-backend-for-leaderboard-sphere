<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cloudinary Upload Test</title>
    <style>
        body {
            font-family: system-ui, Arial, sans-serif;
            max-width: 720px;
            margin: 32px auto;
            padding: 0 16px;
        }

        h1 {
            font-size: 20px;
        }

        form {
            display: grid;
            gap: 12px;
        }

        input[type="text"],
        input[type="file"] {
            padding: 8px;
        }

        button {
            padding: 10px 14px;
            cursor: pointer;
        }

        pre {
            background: #0b1020;
            color: #e6edf3;
            padding: 12px;
            border-radius: 8px;
            overflow: auto;
        }
    </style>
</head>

<body>
    <h1>Cloudinary Upload Test</h1>
    <form id="uploadForm">
        <label>
            API URL
            <input id="apiUrl" type="text" value="http://localhost:3001/api/cloudinary/upload" />
        </label>
        <label>
            File
            <input id="fileInput" type="file" name="file" required />
        </label>
        <button type="submit">Upload</button>
    </form>

    <h2>Response</h2>
    <pre id="output">(no response yet)</pre>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const output = document.getElementById('output');
        const apiUrl = document.getElementById('apiUrl');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            output.textContent = 'Uploading...';

            if (!fileInput.files || fileInput.files.length === 0) {
                output.textContent = 'Please select a file.';
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const res = await fetch(apiUrl.value.trim(), {
                    method: 'POST',
                    body: formData,
                });

                const contentType = res.headers.get('content-type') || '';
                const data = contentType.includes('application/json')
                    ? await res.json()
                    : await res.text();

                output.textContent = typeof data === 'string'
                    ? data
                    : JSON.stringify(data, null, 2);
            } catch (err) {
                output.textContent = err instanceof Error ? err.message : String(err);
            }
        });
    </script>
</body>

</html>